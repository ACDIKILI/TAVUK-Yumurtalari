<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tavuk & Yumurtaları - FIREBASE EDITION</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { margin: 0; background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Courier New', Courier, monospace; touch-action: none; }
        #telefon-cerceve {
            width: 360px; height: 640px; border: 15px solid #000; border-radius: 30px;
            background: #fdf5e6; position: relative; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        #telefon-cerceve::before {
            content: ""; position: absolute; inset: 0;
            background-image: radial-gradient(#ddd 2px, transparent 2px), linear-gradient(0deg, #f0e68c 1px, transparent 1px);
            background-size: 40px 40px, 100% 80px; opacity: 0.15; pointer-events: none;
        }
        canvas { display: block; background: transparent; position: relative; z-index: 1; width: 100%; height: 100%; }
        
        /* Giriş ve Skor Ekranları */
        .overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: gold; text-align: center;
        }
        .input-box {
            background: #333; border: 2px solid gold; color: white; padding: 10px;
            font-size: 20px; text-align: center; text-transform: uppercase; margin: 20px 0; width: 200px;
        }
        .btn {
            background: gold; color: #000; padding: 10px 30px; border: none;
            font-weight: bold; cursor: pointer; border-radius: 5px; font-size: 18px;
        }
        
        /* Paneller */
        .side-panel {
            position: absolute; left: 10px; z-index: 10; font-family: sans-serif;
            background: rgba(0,0,0,0.7); color: #ffd700; padding: 2px 8px;
            border: 2px solid #ffd700; width: 95px; text-align: left; font-size: 11px; font-weight: bold;
        }
        #skor-panel { top: 10px; border-radius: 6px 6px 0 0; color: #fff; border-color: #fff; }
        #puan-panel { top: 31px; border-top: none; border-radius: 0; }
        #altin-panel { top: 52px; color: #ffae00; border-color: #ffae00; border-top: none; border-radius: 0 0 6px 6px; }
        
        .timer-container { position: absolute; left: 15px; top: 85px; width: 50px; height: 50px; z-index: 20; }
        #timerDisplay { position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 16px; color: #333; }

        .market-area { position: absolute; right: 10px; top: 10px; z-index: 10; display: flex; flex-direction: column; gap: 6px; }
        .bonus-group { display: flex; flex-direction: column; width: 100px; background: white; border: 2px solid #001f3f; border-radius: 6px; overflow: hidden; }
        .bonus-main { text-align: center; font-weight: bold; font-size: 11px; padding: 1px; border-bottom: 1px solid #001f3f; }
        .bonus-sub { display: flex; height: 22px; }
        .bonus-btn { flex: 1; display: flex; justify-content: center; align-items: center; font-size: 9px; font-weight: bold; cursor: pointer; border-right: 1px solid #001f3f; background: #fff; }
        .active-glow { background: #ffd700 !important; }
    </style>
</head>
<body>

<div id="telefon-cerceve">
    <div id="authScreen" class="overlay">
        <h1 style="font-size: 24px;">TAVUK & YUMURTALARI</h1>
        <p>OYUNCU İSMİNİZİ GİRİN</p>
        <input type="text" id="playerName" class="input-box" maxlength="10" placeholder="İSİM">
        <button class="btn" onclick="login()">OYUNA BAŞLA</button>
    </div>

    <div id="scoreScreen" class="overlay" style="display:none;">
        <h2 style="color:white; border-bottom: 2px solid gold; padding-bottom: 10px;">DÜNYA SIRALAMASI</h2>
        <div id="rankingList" style="margin: 20px 0; font-size: 18px; line-height: 1.8;"></div>
        <div style="background: rgba(255,215,0,0.2); padding: 10px; border: 1px dashed gold; width: 80%;">
            SİZİN TOPLAM SKORUNUZ: <span id="myTotalScore">0</span>
        </div>
        <button class="btn" style="margin-top: 20px;" onclick="restartGame()">TEKRAR OYNA</button>
    </div>

    <div id="skor-panel" class="side-panel">SKOR: <span id="displaySkor">0</span></div>
    <div id="puan-panel" class="side-panel">PUAN: <span id="skor">0</span></div>
    <div id="altin-panel" class="side-panel">ALTIN: <span id="altinCount">0</span></div>
    
    <div class="timer-container">
        <canvas id="timerCanvas" width="50" height="50"></canvas>
        <div id="timerDisplay">30</div>
    </div>

    <div class="market-area">
        <div class="bonus-group"><div class="bonus-main">2xHız [<span id="st-hiz">0</span>]</div><div class="bonus-sub"><div class="bonus-btn" onclick="market('al','hiz')">AL</div><div class="bonus-btn" id="use-hiz" onclick="market('use','hiz')">KULLAN</div></div></div>
        <div class="bonus-group"><div class="bonus-main">2xPuan [<span id="st-puan">0</span>]</div><div class="bonus-sub"><div class="bonus-btn" onclick="market('al','puan')">AL</div><div class="bonus-btn" id="use-puan" onclick="market('use','puan')">KULLAN</div></div></div>
    </div>

    <canvas id="oyunCanvas"></canvas>
</div>

<script>
    // FIREBASE YAPILANDIRMASI (Cemil Hocam buraya kendi bilgilerinizi giriniz)
    const firebaseConfig = {
        apiKey: "BURAYA_API_KEY_GELECEK",
        databaseURL: "BURAYA_DATABASE_URL_GELECEK",
        projectId: "PROJE_ID",
        storageBucket: "BUCKET",
        messagingSenderId: "SENDER_ID",
        appId: "APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const canvas = document.getElementById('oyunCanvas');
    const ctx = canvas.getContext('2d');
    const tCtx = document.getElementById('timerCanvas').getContext('2d');
    canvas.width = 360; canvas.height = 640;

    let oyuncuAdi = "";
    let toplamSkor = 0, toplamPuan = 0, toplamAltin = 0, stokHiz = 0, stokPuan = 0;
    let aktifHiz = false, aktifPuan = false;
    let oyunBasladi = false, kalanSure = 30;
    let parlamalar = [0,0,0,0,0,0]; // 6 bölge için parlama sayaçları

    // Login Fonksiyonu (Harf filtresi & Büyük harf)
    function login() {
        let input = document.getElementById('playerName').value.trim().toUpperCase();
        if (/^[A-ZÇĞİÖŞÜ]+$/.test(input)) {
            oyuncuAdi = input;
            document.getElementById('authScreen').style.display = 'none';
            if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            ui();
        } else {
            alert("LÜTFEN SADECE HARF GİRİNİZ!");
        }
    }

    const tavukImg = new Image(); tavukImg.src = 'tavuk.png';
    const YUMURTA_TIPLERI = [
        { renk: 'black', puan: 10, agirlik: 1.0 }, { renk: 'purple', puan: 7, agirlik: 0.8 },
        { renk: 'red', puan: 6, agirlik: 0.7 }, { renk: 'green', puan: 5, agirlik: 0.6 },
        { renk: 'lightblue', puan: 4, agirlik: 0.5 }, { renk: 'lightgrey', puan: 3, agirlik: 0.4 },
        { renk: 'yellow', puan: 3, agirlik: 0.4 }, { renk: 'white', puan: 1, agirlik: 0.2 }
    ];

    const fabrikaAyarlari = () => [
        { x: 180, y: 180, uzunluk: 150, aci: 0, temelHiz: 0.008 },
        { x: 75, y: 280, uzunluk: 150, aci: 0, temelHiz: -0.012 },
        { x: 285, y: 280, uzunluk: 150, aci: 0, temelHiz: 0.006 },
        { x: 180, y: 380, uzunluk: 150, aci: 0, temelHiz: -0.010 },
        { x: 75, y: 480, uzunluk: 150, aci: 0, temelHiz: 0.008 },
        { x: 285, y: 480, uzunluk: 150, aci: 0, temelHiz: -0.004 }
    ];
    let tahtiravalliler = fabrikaAyarlari();
    let yumurtalar = [];

    function market(eylem, tip) {
        if (oyunBasladi) return;
        if (eylem === 'al') { if (toplamAltin >= 10) { toplamAltin -= 10; tip === 'hiz' ? stokHiz++ : stokPuan++; } }
        else { if (tip === 'hiz' && stokHiz > 0) { aktifHiz = !aktifHiz; document.getElementById('use-hiz').classList.toggle('active-glow'); }
               if (tip === 'puan' && stokPuan > 0) { aktifPuan = !aktifPuan; document.getElementById('use-puan').classList.toggle('active-glow'); } }
        ui();
    }

    function ui() {
        document.getElementById('displaySkor').innerText = toplamSkor;
        document.getElementById('skor').innerText = toplamPuan;
        document.getElementById('altinCount').innerText = toplamAltin;
        document.getElementById('st-hiz').innerText = stokHiz;
        document.getElementById('st-puan').innerText = stokPuan;
    }

    canvas.addEventListener('mousedown', (e) => {
        if (!oyuncuAdi) return;
        const rect = canvas.getBoundingClientRect();
        const mx = (e.clientX - rect.left) * (canvas.width / rect.width);
        const my = (e.clientY - rect.top) * (canvas.height / rect.height);
        
        if (!oyunBasladi && mx > 140 && mx < 240 && my > 30 && my < 155) {
            oyunBasladi = true; if(aktifHiz) stokHiz--; if(aktifPuan) stokPuan--; ui(); start();
        }
        if (oyunBasladi) tahtiravalliler.forEach(t => {
            if (Math.sqrt((mx - t.x)**2 + (my - t.y)**2) < t.uzunluk/2) t.temelHiz *= (mx > t.x ? 1.15 : 0.85);
        });
    });

    function start() {
        let yT = setInterval(() => { if(oyunBasladi) yumurtalar.push(new Yumurta()); }, aktifHiz ? 1100 : 2200);
        let sT = setInterval(() => {
            if(!oyunBasladi) return; kalanSure--; document.getElementById('timerDisplay').innerText = kalanSure;
            if(kalanSure <= 0) { clearInterval(sT); clearInterval(yT); end(); }
        }, 1000);
    }

    async function end() {
        oyunBasladi = false;
        let nA = Math.floor(toplamPuan / 50); toplamAltin += nA; toplamPuan -= (nA * 50);
        
        // Firebase Güncelleme (Kariyer Protokolü)
        const playerRef = database.ref('ty_players/' + oyuncuAdi);
        await playerRef.once('value', snapshot => {
            let currentTotal = (snapshot.val() && snapshot.val().totalScore) || 0;
            playerRef.set({ totalScore: currentTotal + toplamSkor });
        });

        showLeaderboard();
    }

    function showLeaderboard() {
        database.ref('ty_players').orderByChild('totalScore').limitToLast(5).once('value', snapshot => {
            let players = [];
            snapshot.forEach(child => { players.push({name: child.key, score: child.val().totalScore}); });
            players.reverse();

            let listHtml = "";
            players.forEach((p, i) => {
                listHtml += `<div>${i+1}. ${p.name} - ${p.score}</div>`;
            });
            document.getElementById('rankingList').innerHTML = listHtml;
            
            database.ref('ty_players/' + oyuncuAdi).once('value', s => {
                document.getElementById('myTotalScore').innerText = s.val().totalScore;
            });

            document.getElementById('scoreScreen').style.display = 'flex';
        });
    }

    function restartGame() {
        document.getElementById('scoreScreen').style.display = 'none';
        toplamSkor = 0; kalanSure = 30; yumurtalar = []; tahtiravalliler = fabrikaAyarlari();
        aktifHiz = false; aktifPuan = false;
        document.querySelectorAll('.active-glow').forEach(el => el.classList.remove('active-glow'));
        ui();
    }

    class Yumurta {
        constructor() {
            const t = YUMURTA_TIPLERI[Math.floor(Math.random()*YUMURTA_TIPLERI.length)];
            this.x = 180; this.y = 110; this.r = 10; this.renk = t.renk; this.puan = t.puan; this.ag = t.agirlik;
            this.vy = 0; this.vx = (Math.random()-0.5)*0.4; this.aci = 0; this.aktif = true;
        }
        guncelle() {
            if (!this.aktif) return;
            this.vy += 0.06 * this.ag; this.y += this.vy; this.x += this.vx;
            const tampon = this.r * 2;
            if (this.x < tampon) { this.x = tampon; this.vx *= -0.7; }
            if (this.x > canvas.width - tampon) { this.x = canvas.width - tampon; this.vx *= -0.7; }

            tahtiravalliler.forEach(t => {
                let dx = this.x - t.x, dy = this.y - t.y;
                let cos = Math.cos(-t.aci), sin = Math.sin(-t.aci), rx = dx*cos - dy*sin, ry = dx*sin + dy * cos;
                if (Math.abs(rx) < t.uzunluk/2 && Math.abs(ry) < 12) {
                    this.vx += Math.sin(t.aci)*0.2; this.vy *= 0.1;
                    this.y = t.y + (this.x-t.x)*Math.tan(t.aci) - 10; this.aci += this.vx*0.2;
                }
            });
            if (this.y > 605) {
                let idx = Math.floor(this.x / (canvas.width/6));
                if (idx >= 0 && idx < 6) {
                    let kazanc = (this.puan * [1,2,3,1,2,3][idx]) * (aktifPuan ? 2 : 1);
                    toplamSkor += kazanc; toplamPuan += kazanc; ui();
                    parlamalar[idx] = 15; // Parlama tetikle
                    this.aktif = false;
                }
            }
        }
        ciz() {
            if (!this.aktif) return;
            ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.aci);
            ctx.fillStyle = this.renk; ctx.beginPath(); ctx.ellipse(0, 0, 8, 10, 0, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = "#000"; ctx.lineWidth = 1.5; ctx.stroke(); ctx.restore();
        }
    }

    function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        try { ctx.drawImage(tavukImg, 140, 45, 80, 80); } catch(e) {}
        
        // Alt Bölge ve Parlama
        [1,2,3,1,2,3].forEach((c, i) => {
            let renkBase = ['#e74c3c','#3498db','#2ecc71','#f1c40f','#9b59b6','#e67e22'][i];
            ctx.fillStyle = renkBase;
            ctx.fillRect(i*(canvas.width/6), 600, canvas.width/6, 40);
            
            if (parlamalar[i] > 0) {
                ctx.fillStyle = "rgba(255,255,255," + (parlamalar[i]/20) + ")";
                ctx.fillRect(i*(canvas.width/6), 600, canvas.width/6, 40);
                parlamalar[i]--;
            }

            ctx.fillStyle="#000"; ctx.font="bold 12px Arial"; ctx.textAlign="center";
            ctx.fillText(c+"x", i*(canvas.width/6)+30, 625);
        });

        tahtiravalliler.forEach(t => {
            ctx.save(); ctx.translate(t.x, t.y); ctx.rotate(t.aci);
            ctx.strokeStyle="#5d2e0a"; ctx.lineWidth=10; ctx.lineCap="round";
            ctx.beginPath(); ctx.moveTo(-t.uzunluk/2,0); ctx.lineTo(t.uzunluk/2,0); ctx.stroke();
            ctx.fillStyle="#000"; ctx.beginPath(); ctx.arc(0,0,6,0,Math.PI*2); ctx.fill(); ctx.restore();
            if (oyunBasladi) { t.aci += t.temelHiz; if(Math.abs(t.aci)>0.6) t.temelHiz*=-1; }
        });

        if (oyunBasladi) {
            yumurtalar.forEach(y => { y.guncelle(); y.ciz(); });
            tCtx.clearRect(0, 0, 50, 50); tCtx.beginPath();
            tCtx.arc(25, 25, 21, -Math.PI/2, (-Math.PI/2) + (Math.PI*2 * (kalanSure/30)));
            tCtx.strokeStyle = kalanSure <= 10 ? "#ff4d4d" : "#ffd700"; tCtx.lineWidth = 5; tCtx.stroke();
        }
        if (!oyunBasladi && oyuncuAdi && document.getElementById('scoreScreen').style.display === 'none') {
            ctx.fillStyle="#333"; ctx.font="bold 18px Courier New"; ctx.textAlign="center"; ctx.fillText("BAŞLAT", 180, 145);
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>