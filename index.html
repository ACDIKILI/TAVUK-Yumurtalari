<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tavuk & YumurtalarÄ± - ACDgames</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        /* KUTSAL SEÃ‡Ä°M VE ZOOM ENGELÄ° */
        * { 
            -webkit-tap-highlight-color: transparent; 
            -webkit-touch-callout: none; 
            -webkit-user-select: none; 
            user-select: none; 
            touch-action: manipulation;
        }
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        #telefon-cerceve {
            width: 360px; height: 640px; border: 12px solid #333; border-radius: 40px;
            background: #fdf5e6; position: relative; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        canvas { display: block; background: transparent; position: relative; z-index: 1; }
        
        /* BEYAZ KÃ–ÅžE TEMÄ°ZLÄ°ÄžÄ° VE SKOR EKRANI */
        .overlay { 
            position: absolute; inset: 0; background: #000; z-index: 2000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .ranking-box { 
            width: 90%; background: #001a00; border: 3px solid #f1c40f; border-radius: 20px; 
            padding: 20px; color: #f1c40f; box-sizing: border-box;
        }
        .login-btn { 
            width: 70%; height: 55px; background: #f1c40f; border: none; border-radius: 15px; 
            color: #000; font-size: 22px; font-weight: bold; cursor: pointer; margin-top: 15px;
        }
        .side-panel { 
            position: absolute; left: 10px; z-index: 10; background: rgba(0,0,0,0.7); 
            color: #ffd700; padding: 2px 8px; border: 2px solid #ffd700; width: 95px; font-size: 11px; font-weight: bold;
        }
        #skor-panel { top: 10px; border-radius: 6px 6px 0 0; color: #fff; border-color: #fff; }
        #puan-panel { top: 31px; border-top: none; }
        #altin-panel { top: 52px; color: #ffae00; border-color: #ffae00; border-top: none; border-radius: 0 0 6px 6px; }
        .market-area { position: absolute; right: 10px; top: 10px; z-index: 10; display: flex; flex-direction: column; gap: 6px; }
        .bonus-group { background: white; border: 2px solid #001f3f; border-radius: 6px; overflow: hidden; width: 100px; text-align: center; font-size: 10px; }
    </style>
</head>
<body>

<div id="telefon-cerceve">
    <div id="authScreen" class="overlay">
        <div style="color:#fff; margin-bottom:20px; font-weight:bold;">ACDgames Sunar</div>
        <div style="color:#f1c40f; font-size:24px; margin-bottom:30px;">TAVUK & YUMURTALARI</div>
        <input type="text" id="playerName" placeholder="Ä°SÄ°M GÄ°RÄ°N" maxlength="10" style="width:80%; height:50px; text-align:center; font-size:20px; text-transform:uppercase;">
        <button class="login-btn" onclick="login()">BAÅžLA</button>
    </div>

    <div id="scoreScreen" class="overlay" style="display:none;">
        <div class="ranking-box">
            <div style="text-align:center; font-weight:bold; margin-bottom:15px;">DÃœNYA KLASMANI</div>
            <div id="rankingList"></div>
            <div style="margin-top:15px; border-top:1px solid gold; padding-top:10px; text-align:center;">
                KARÄ°YER: <span id="myTotalScore">0</span><br>
                SKOR: <span id="myGameScore" style="color:white;">0</span>
            </div>
        </div>
        <button id="restartBtn" class="login-btn" onclick="restartGame()" style="display:none;">TEKRAR</button>
    </div>

    <div id="skor-panel" class="side-panel">SKOR: <span id="displaySkor">0</span></div>
    <div id="puan-panel" class="side-panel">PUAN: <span id="skor">0</span></div>
    <div id="altin-panel" class="side-panel">ALTIN: <span id="altinCount">0</span></div>

    <canvas id="oyunCanvas"></canvas>
</div>

<script>
    // FIREBASE YAPILANDIRMASI
    const firebaseConfig = {
        apiKey: "AIzaSyBbtvGBl8m1x8thDlsUUutvujedIBCC4PA",
        authDomain: "blackjack-4x4.firebaseapp.com",
        databaseURL: "https://blackjack-4x4-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "blackjack-4x4",
        storageBucket: "blackjack-4x4.firebasestorage.app",
        messagingSenderId: "805180924640",
        appId: "1:805180924640:web:c7da5f8c037b7ff5c26685"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const canvas = document.getElementById('oyunCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 360; canvas.height = 640;

    let oyuncuAdi = "", toplamSkor = 0, toplamPuan = 0, toplamAltin = 0, oyunBasladi = false, kalanSure = 30;

    async function login() {
        let input = document.getElementById('playerName').value.trim().toUpperCase();
        if (input) {
            oyuncuAdi = input;
            const ref = database.ref('ty_players/' + oyuncuAdi);
            await ref.once('value', s => {
                const data = s.val() || {};
                toplamSkor = data.totalScore || 0;
                toplamAltin = data.gold || 0;
                toplamPuan = data.points || 0;
            });
            document.getElementById('authScreen').style.display = 'none';
            ui();
        }
    }

    async function end() {
        oyunBasladi = false;
        document.getElementById('myGameScore').innerText = Math.floor(toplamSkor);
        
        let nA = Math.floor(toplamPuan / 100); 
        toplamAltin += nA; 
        toplamPuan -= (nA * 100); 

        const ref = database.ref('ty_players/' + oyuncuAdi);
        await ref.set({
            totalScore: Math.floor(toplamSkor),
            gold: toplamAltin,
            points: Math.floor(toplamPuan)
        });
        showRanking();
    }

    function showRanking() {
        database.ref('ty_players').orderByChild('totalScore').limitToLast(5).once('value', s => {
            let p = []; s.forEach(c => { p.push({n: c.key, s: c.val().totalScore}); });
            p.reverse();
            let h = ""; p.forEach((v, i) => h += `<div style="display:flex; justify-content:space-between; margin:5px 0;"><span>${i+1}. ${v.n}</span><span>${v.s}</span></div>`);
            document.getElementById('rankingList').innerHTML = h;
            document.getElementById('myTotalScore').innerText = toplamSkor;
            document.getElementById('scoreScreen').style.display = 'flex';
            
            // YANLIÅžLIKLA TIKLAMA KORUMASI: 1 saniye sonra buton gÃ¶rÃ¼nÃ¼r
            setTimeout(() => { document.getElementById('restartBtn').style.display = 'block'; }, 1000);
        });
    }

    function restartGame() {
        document.getElementById('scoreScreen').style.display = 'none';
        document.getElementById('restartBtn').style.display = 'none';
        toplamSkor = 0; kalanSure = 30;
        ui();
    }

    function ui() {
        document.getElementById('displaySkor').innerText = Math.floor(toplamSkor);
        document.getElementById('skor').innerText = Math.floor(toplamPuan);
        document.getElementById('altinCount').innerText = toplamAltin;
    }

    function loop() {
        ctx.clearRect(0, 0, 360, 640);
        // Paskalya YumurtasÄ±
        ctx.font = "60px Arial";
        ctx.textAlign = "center";
        ctx.fillText("ðŸ¥š", 180, 110);
        
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
